<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB">
<head>
<meta charset="UTF-8"/>
<title>Wanderer</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>

<h1>Spawning</h1>

<p>A level needs to be able to create new entity objects of different types,
according to the character codes in textual level files.  This is tricky,
because <code>Level</code> is a framework class which knows nothing about the
entity classes.</p>

<h3>Reflection</h3>

<p>One possibility is to use Java's reflection facilities.  A level object is
given the names of the classes that generate the different types of entity. Then
reflection is used to create an entity object using a given class name, e.g.
like this:</p>

<pre>E e = (E) Class.forName(className).newInstance();
</pre>

<p>This will need a warning suppression.  A slight weakness of this approach is
that it requires the entity classes to be public.  To get round that, if
desired, the reflection code can be made a little more complex:</p>

<pre>Class&lt;?> c = Class.forName(t.className());
Constructor&lt;?> con = c.getDeclaredConstructor();
con.setAccessible(true);
E e = (E) con.newInstance();
</pre>

<p>However, this general approach assumes that each type of entity is
represented by a separate class.  It would be preferable, in a framework, to
provide more flexibility.</p>

<h3>Cloning</h3>

<p>Generally, developers are advised to avoid Java's cloning features.  However,
it does provide a way for framework classes to create objects of custom classes,
without using reflection.  The <code>Cell</code> class can implement the
<code>Cloneable</code> intrerface and provide a <code>clone</code> method:</p>

<pre>@SuppressWarnings("unchecked")
public E clone() {
    try { return (E) super.clone(); }
    catch (Exception e) { throw new Error(e); }
}
</pre>

<p>This assumes that shallow cloning will always be appropriate, but fields of
entity objects are likely to be primitive or immutable or references to shared
objects, so this is very likely.  Now the <code>clone</code> method can be
called on any entity class, without any specific supporting code being needed in
any custom classes.  A collection of sample entities, one of each type, can be
stored in the level object, and used both by the level object and by individual
entities, to spawn new entities.</p>

</body>
</html>
